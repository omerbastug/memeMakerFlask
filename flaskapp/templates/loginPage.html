{% extends  'twoColumnLayout.html' %}
{% block css %}
    <link href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet">
{% endblock %}

{% block title %}
Login
{% endblock %}

{% block content1 %}
<form id="loginform">
    <!-- Email input -->
    <div class="form-outline mb-4">
        <input type="email" name="email" id="form3Example3" class="form-control form-control-lg"
            placeholder="Enter a valid email address" />
        <label class="form-label" for="form3Example3">Email address</label>
    </div>

    <!-- Password input -->
    <div class="form-outline mb-3">
        <input type="password" name="password" id="form3Example4" class="form-control form-control-lg"
            placeholder="Enter password" />
        <label class="form-label" for="form3Example4">Password</label>
    </div>

    <div class="text-center text-lg-start mt-4 pt-2">
        <button id="submitbtnnn" type="submit" class="btn btn-primary btn-lg"
        style="padding-left: 2.5rem; padding-right: 2.5rem;">Login
        </button>
        <p class="small fw-bold mt-2 pt-1 mb-0">Don't have an account? 
            <a href="{{url_for('register_meme_page')}}" class="link-danger" id="registerForm">
                Register
            </a>
        </p>
    </div>
  </form>
{% endblock %}

{% block content2 %}
<img id="greetingimg" src="https://pbs.twimg.com/media/FF4lj5-XIAAPCn1?format=jpg&name=small" style="width: 100%;" alt="sample greeting image">
{% endblock %}

{% block js%}
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

    <script>
        $("#loginform").validate({
            submitHandler: function(formdata){
                var user = Object.fromEntries((new FormData(formdata)).entries());
                $("#submitbtnnn").attr('disabled',true);
                $.ajax({
                    url: '/api/login',
                    type: 'POST',
                    data: JSON.stringify(user),
                    contentType: "application/json",
                    dataType: "json",
                    success: function(result) {
                        console.log(result);
                        localStorage.setItem("token", result.token);
                        localStorage.setItem("user", JSON.stringify(result.user));
                        localStorage.setItem("loggedIn", true);
                        location.replace("/")
                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                        $("#submitbtnnn").removeAttr('disabled');
                        toastr.error(XMLHttpRequest.responseJSON.message);
                    }
                });
            }
        })
    </script>
{% endblock %}